<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ftblzone - CanlÄ± MaÃ§ Takip ve Linkler</title>

<script async src="https://www.googletagmanager.com/gtag/js?id=G-RY0R6H71QX"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-RY0R6H71QX');
</script>

<style>
/* GENEL STÄ°LLER */
body{font-family:Arial,sans-serif;text-align:center;margin:0;padding:10px;transition:background 0.5s,color 0.5s; background-color: #fff; color: #000;}
h1,h2,h3,h4{margin:10px 0;}
button{margin:5px;padding:10px 20px;border:none;cursor:pointer;border-radius:6px;font-size:16px; background-color: #333; color: white; transition: background-color 0.3s;}
button:hover { opacity: 0.9; }
input,select,textarea{margin:6px;padding:8px;border-radius:6px;font-size:16px;width:90%;max-width:300px; border: 1px solid #ccc; transition: border-color 0.3s;}
input:focus, select:focus, textarea:focus { border-color: #007bff; outline: none; }
textarea{resize:vertical;}

/* YERLEÅÄ°M VE GÃ–RÃœNÃœM */
.adminPanel{display:none;margin-top:20px;border:1px solid #ccc;padding:15px;text-align:left; max-width: 800px; margin: 20px auto; background-color: #f9f9f9;}
.timers,.links,.themeChanger,.adminLogin,.predictionGame,.quizContainer, .pollContainer, .feedbackContainer{margin-top:30px; padding: 15px; border-bottom: 1px solid #eee; margin-bottom: 25px; border-radius: 8px;}
a{display:block;margin:5px 0;color:inherit;text-decoration:none; font-weight: bold;}

/* GÃœNCELLEME: BASÄ°T LÄ°STE VE BOÅLUK STÄ°LÄ° */
.links div[id$="Links"], 
.links div[id$="Summary"] {
    margin-bottom: 30px;
    border: 1px dashed #ddd;
    padding: 15px;
    border-radius: 6px;
    background-color: #fcfcfc;
}
.linkItem{
    display: block; 
    margin: 10px auto; 
    max-width: 700px;
    padding: 8px 0;
    border-bottom: 1px dotted #e0e0e0;
    text-align: left;
    background: none; 
    color: inherit;
    font-size: 1.05em;
}
.linkItem:last-child { border-bottom: none; }
.linkItem a { 
    display: inline; 
    font-weight: normal;
    color: #007bff;
    text-decoration: underline;
}
.linkItem span{
    display: inline-block;
    font-size: 0.9em;
    color: #777;
    margin-left: 15px;
}
.timerItem{border:1px solid #ddd;border-radius:8px;padding:15px;margin:10px auto;max-width:450px;text-align:center; background-color: #f0f0f0; color: #333; box-shadow: 0 2px 5px rgba(0,0,0,0.05);}
.timerItem p{margin: 0;}
#allNextMatchesContainer, #allNextMatchesContainer2, #allNextMatchesContainer3 { display: flex; flex-wrap: wrap; justify-content: center; gap: 20px;}

/* TAHMÄ°N OYUNU STÄ°LLERÄ° */
.predictionGame { background-color: #e9f5ff; border: 2px solid #007bff; border-radius: 12px; padding: 25px;}
/* ... (DiÄŸer tahmin stilleri orijinal kodunuzdan kalmÄ±ÅŸtÄ±r) ... */

/* DUYURU STÄ°LLERÄ° */
#announcementBar { 
    background-color: #dc3545;
    color: white; 
    padding: 10px; 
    margin-bottom: 25px; 
    font-weight: bold; 
    height: 35px; 
    overflow: hidden; 
    position: relative; 
    border-radius: 6px;
}
.announcement-item { 
    /* ... (Orijinal duyuru stilleri korunmuÅŸtur) ... */
    position: absolute; 
    width: 100%; 
    text-align: center; 
    top: 10px; 
    opacity: 0; 
    transition: all 0.5s ease-in-out; 
}
.announcement-item.active { opacity: 1; transform: none; }

/* QUIZ VE ANKET STÄ°LLERÄ° */
.quizContainer { border: 2px solid #5aa1e3; border-radius: 12px; padding: 25px; background-color: #f5faff; }
.pollContainer { border: 2px solid #28a745; border-radius: 12px; padding: 25px; background-color: #f0fff0; }

/* Geri Bildirim Stilleri */
.feedbackContainer { 
    margin-top: 30px; 
    padding: 25px; 
    border: 2px solid #5cb85c; 
    border-radius: 12px; 
    background-color: #f9fff9; 
    max-width: 500px;
    margin: 30px auto;
}
.feedbackContainer button { background-color: #5cb85c; }

/* TEMA STÄ°LLERÄ° */
/* ... (Tema stilleri orijinal kodunuzdan kalmÄ±ÅŸtÄ±r) ... */

/* ARAYÃœZ SEÃ‡Ä°MÄ° STÄ°LLERÄ° */
/* ... (ArayÃ¼z seÃ§im stilleri orijinal kodunuzdan kalmÄ±ÅŸtÄ±r) ... */

/* SÄ°DEBAR MENÃœ */
/* ... (Sidebar stilleri orijinal kodunuzdan kalmÄ±ÅŸtÄ±r) ... */

/* PROFÄ°L STÄ°LLERÄ° */
/* ... (Profil stilleri orijinal kodunuzdan kalmÄ±ÅŸtÄ±r) ... */

/* TAHMÄ°N GEÃ‡MÄ°ÅÄ° */
/* ... (Tahmin geÃ§miÅŸi stilleri orijinal kodunuzdan kalmÄ±ÅŸtÄ±r) ... */

/* ADMIN PANELÄ° STÄ°LLERÄ° (GeliÅŸtirildi) */
.admin-controls {
    margin-bottom: 25px;
    padding: 20px;
    border: 1px solid #cceeff;
    border-radius: 10px;
    background-color: #e6f7ff;
    text-align: left;
}
.admin-controls h4 {
    margin-top: 0;
    color: #007bff;
    border-bottom: 1px solid #b3e0ff;
    padding-bottom: 10px;
    margin-bottom: 15px;
}
.admin-controls button {
    margin-top: 10px;
}

/* YENÄ°: Duyuru KaldÄ±rma DÃ¼ÄŸmesi Stili */
.announcement-item-admin {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 0;
    border-bottom: 1px dotted #ccc;
    font-size: 0.95em;
}
.announcement-item-admin:last-child { border-bottom: none; }
.remove-announcement-btn {
    background-color: #dc3545;
    color: white;
    padding: 5px 10px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 12px;
    transition: background-color 0.3s;
}
.remove-announcement-btn:hover {
    background-color: #c82333;
}
</style>
</head>
<body>
<div id="interfaceChoice" class="interface-choice">
    <div class="interface-options">
        <h2>ftblzone'a HoÅŸ Geldiniz!</h2>
        <p>LÃ¼tfen kullanmak istediÄŸiniz arayÃ¼zÃ¼ seÃ§in:</p>
        
        <div class="interface-option" id="simpleOption" onclick="selectInterface('simple')">
            <h3>Basit ArayÃ¼z</h3>
            <p>TÃ¼m iÃ§erik tek sayfada, hÄ±zlÄ± ve sade</p>
        </div>
        
        <div class="interface-option" id="menuOption" onclick="selectInterface('menu')">
            <h3>MenÃ¼lÃ¼ ArayÃ¼z</h3>
            <p>Sol tarafta menÃ¼ ile kolay gezinme</p>
        </div>
        
        <p style="margin-top: 20px; font-size: 0.9em; color: #777;">Daha sonra ayarlardan deÄŸiÅŸtirebilirsiniz</p>
    </div>
</div>

<button id="menuToggle" style="display:none;">â˜°</button>

<div id="sidebar">
    <ul>
        <li><a href="#" onclick="showSection('home')">ğŸ  Ana Sayfa</a></li>
        <li><a href="#" onclick="showSection('links')">âš½ MaÃ§ Linkleri</a></li>
        <li><a href="#" onclick="showSection('timers')">â° Geri SayÄ±mlar</a></li>
        <li><a href="#" onclick="showSection('quiz')">ğŸ§  Bilgi YarÄ±ÅŸmasÄ±</a></li>
        <li><a href="#" onclick="showSection('poll')">ğŸ”— Duyuru/Link</a></li>
        <li><a href="#" onclick="showSection('prediction')">ğŸ† Tahmin Oyunu</a></li>
        <li><a href="#" onclick="showSection('profile')">ğŸ‘¤ Profilim</a></li>
        <li><a href="#" onclick="showSection('feedback')">ğŸ“§ Geri Bildirim</a></li>
        <li><a href="#" onclick="showSection('settings')">âš™ï¸ Ayarlar</a></li>
    </ul>
</div>

<div id="announcementBar"></div>

<div id="simpleInterface" style="display:none;">
    <h1>ftblzone - MaÃ§ Linkleri ve Bilgileri</h1>

    <div id="weeklyWinner" style="display: none;"></div>

    <div class="timers">
        <h3>â° MaÃ§ Geri SayÄ±mlarÄ±</h3>
        <div id="allNextMatchesContainer"></div>
    </div>

    <div class="quizContainer">
        <h2>ğŸ§  Bilgi YarÄ±ÅŸmasÄ± (Quiz)</h2>
        <div id="quizGameContainer">
            <p style="font-style: italic; color: #777;">Åu anda aktif bir bilgi yarÄ±ÅŸmasÄ± bulunmamaktadÄ±r.</p>
        </div>
    </div>

    <div class="pollContainer">
        <h2>ğŸ”— SÃ¼reli Duyuru/Link</h2>
        <div id="pollGameContainer">
            <p style="font-style: italic; color: #777;">Åu anda aktif bir anket bulunmamaktadÄ±r.</p>
        </div>
    </div>

    <div class="predictionGame">
        <h2>ğŸ† MaÃ§ Tahmin Oyunu</h2>
        <div id="predictionGameContainer">
            <p style="font-style: italic; color: #777;">Åu anda aktif bir tahmin oyunu bulunmamaktadÄ±r.</p>
        </div>
    </div>

    <div style="max-width: 500px; margin: 20px auto;">
        <input type="text" id="linkSearch" onkeyup="searchLinks()" placeholder="Linklerde Arama Yap (Ã–rn: FB GS, Bein)">
    </div>

    <div class="links">
        <h2 id="dailyLinksHeader">âš½ GÃ¼nlÃ¼k MaÃ§ Linkleri</h2>
        <div id="dailyLinks"></div>

        <h2>ğŸ‡¹ğŸ‡· TÃ¼rkiye 4 BÃ¼yÃ¼kler Linkleri</h2>
        <div id="big4Links"></div>

        <h2>ğŸ¥… Gol VideolarÄ±</h2>
        <div id="goalLinks"></div>

        <h2>ğŸ¬ MaÃ§ Ã–zetleri</h2>
        <h4>KÄ±sa Ã–zet</h4>
        <div id="shortSummary"></div>
        <h4>Uzun Ã–zet</h4>
        <div id="longSummary"></div>
    </div>

    <div class="feedbackContainer">
        <h2>ğŸ“§ Ã–neri, Åikayet ve Ä°letiÅŸim</h2>
        <input type="text" id="feedbackName" placeholder="AdÄ±nÄ±z">
        <input type="email" id="feedbackEmail" placeholder="E-posta Adresiniz (Ä°steÄŸe BaÄŸlÄ±)">
        <textarea id="feedbackMessage" placeholder="MesajÄ±nÄ±z (Ã–neri, Åikayet, Hata Bildirimi)" rows="4"></textarea>
        <button id="submitFeedbackBtnSimple">Geri Bildirim GÃ¶nder</button>
    </div>

    <div class="themeChanger">
        <h3>Tema SeÃ§in</h3>
        <select id="themeSelect">
            <option value="white">Beyaz (VarsayÄ±lan)</option>
            <option value="black">Siyah</option>
            <option value="yellow-red">SarÄ±-KÄ±rmÄ±zÄ±</option>
            <option value="yellow-blue">SarÄ±-Lacivert</option>
            <option value="black-white">Siyah-Beyaz</option>
            <option value="claret-blue">Bordo-Mavi</option>
        </select>
        <button id="versionModalBtnSimple" style="background-color: #555; margin-top: 15px;">SÃ¼rÃ¼m ve GÃ¼ncelleme NotlarÄ±</button>
        <button id="changeInterfaceBtnSimple" style="background-color: #007bff; margin-top: 15px;">ArayÃ¼zÃ¼ DeÄŸiÅŸtir</button>
    </div>

    <div class="adminLogin" id="adminLogin">
        <h2>ğŸ”‘ YÃ¶netici GiriÅŸi</h2>
        <input type="password" id="adminPass" placeholder="Åifre">
        <button id="adminLoginBtnSimple">GiriÅŸ</button>
    </div>
</div>

<div id="menuInterface" style="display:none;">
    <div id="mainContent">
        <div id="homeSection" class="section active">
            </div>

        <div id="profileSection" class="section" style="display:none;">
            <h1>ğŸ‘¤ Profilim</h1>
            
            <div class="profile-section">
                <button id="editProfileBtn">Profili DÃ¼zenle</button>
                <button id="showHistoryBtn">Tahmin GeÃ§miÅŸi</button>
            </div>
            
            <div id="predictionHistory" class="prediction-history" style="display:none;">
                <h3>Tahmin GeÃ§miÅŸin</h3>
                <div id="predictionHistoryList"></div>
            </div>
        </div>

        <div id="linksSection" class="section" style="display:none;">
            <h1>ftblzone - MaÃ§ Linkleri ve Bilgileri</h1>
            
            <div style="max-width: 500px; margin: 20px auto;">
                <input type="text" id="linkSearch2" onkeyup="searchLinks()" placeholder="Linklerde Arama Yap (Ã–rn: FB GS, Bein)">
            </div>

            <div class="links">
                <h2 id="dailyLinksHeader2">âš½ GÃ¼nlÃ¼k MaÃ§ Linkleri</h2>
                <div id="dailyLinks2"></div>

                <h2>ğŸ‡¹ğŸ‡· TÃ¼rkiye 4 BÃ¼yÃ¼kler Linkleri</h2>
                <div id="big4Links2"></div>

                <h2>ğŸ¥… Gol VideolarÄ±</h2>
                <div id="goalLinks2"></div>

                <h2>ğŸ¬ MaÃ§ Ã–zetleri</h2>
                <h4>KÄ±sa Ã–zet</h4>
                <div id="shortSummary2"></div>
                <h4>Uzun Ã–zet</h4>
                <div id="longSummary2"></div>
            </div>
        </div>
        
        <div id="timersSection" class="section" style="display:none;">
            <h1>â° MaÃ§ Geri SayÄ±mlarÄ±</h1>
            <div id="allNextMatchesContainer3"></div>
        </div>

        <div id="quizSection" class="section" style="display:none;">
            <h1>ğŸ§  Bilgi YarÄ±ÅŸmasÄ±</h1>
            <div class="quizContainer">
                <div id="quizGameContainer2">
                    <p style="font-style: italic; color: #777;">Åu anda aktif bir bilgi yarÄ±ÅŸmasÄ± bulunmamaktadÄ±r.</p>
                </div>
            </div>
        </div>

        <div id="pollSection" class="section" style="display:none;">
            <h1>ğŸ”— SÃ¼reli Duyuru/Link</h1>
            <div class="pollContainer">
                <div id="pollGameContainer2">
                    <p style="font-style: italic; color: #777;">Åu anda aktif bir anket bulunmamaktadÄ±r.</p>
                </div>
            </div>
        </div>

        <div id="predictionSection" class="section" style="display:none;">
            <h1>ğŸ† MaÃ§ Tahmin Oyunu</h1>
            <div class="predictionGame">
                <div id="predictionGameContainer2">
                    <p style="font-style: italic; color: #777;">Åu anda aktif bir tahmin oyunu bulunmamaktadÄ±r.</p>
                </div>
            </div>
        </div>

        <div id="feedbackSection" class="section" style="display:none;">
            <h1>ğŸ“§ Geri Bildirim</h1>
            <div class="feedbackContainer">
                <input type="text" id="feedbackName2" placeholder="AdÄ±nÄ±z">
                <input type="email" id="feedbackEmail2" placeholder="E-posta Adresiniz (Ä°steÄŸe BaÄŸlÄ±)">
                <textarea id="feedbackMessage2" placeholder="MesajÄ±nÄ±z (Ã–neri, Åikayet, Hata Bildirimi)" rows="4"></textarea>
                <button id="submitFeedbackBtnMenu">Geri Bildirim GÃ¶nder</button>
            </div>
        </div>

        <div id="settingsSection" class="section" style="display:none;">
            <h1>âš™ï¸ Ayarlar</h1>
            <div class="themeChanger">
                <h3>Tema SeÃ§in</h3>
                <select id="themeSelect2">
                    <option value="white">Beyaz (VarsayÄ±lan)</option>
                    <option value="black">Siyah</option>
                    <option value="yellow-red">SarÄ±-KÄ±rmÄ±zÄ±</option>
                    <option value="yellow-blue">SarÄ±-Lacivert</option>
                    <option value="black-white">Siyah-Beyaz</option>
                    <option value="claret-blue">Bordo-Mavi</option>
                </select>
                <button id="versionModalBtnMenu">SÃ¼rÃ¼m ve GÃ¼ncelleme NotlarÄ±</button>
                <button id="changeInterfaceBtnMenu">ArayÃ¼zÃ¼ DeÄŸiÅŸtir</button>
            </div>
            
            <div class="adminLogin" id="adminLogin2" style="margin-top: 30px;">
                <h2>ğŸ”‘ YÃ¶netici GiriÅŸi</h2>
                <input type="password" id="adminPass2" placeholder="Åifre">
                <button id="adminLoginBtnMenu">GiriÅŸ</button>
            </div>
        </div>
    </div>
</div>

<div id="editProfileModal" class="modal">
    </div>

<div class="adminPanel" id="adminPanel">
    <h3>Admin Paneli - Ä°Ã§erik YÃ¶netimi</h3>
    <button id="logoutAdminBtn">Ã‡Ä±kÄ±ÅŸ Yap</button>
    <hr>

    <div class="admin-controls" id="announcementAdminControls">
        <h4>ğŸ“¢ Ã‡oklu Duyuru YÃ¶netimi (Silme Ã–zelliÄŸi Eklendi)</h4>
        <input id="newAnnouncementText" placeholder="Yeni Duyuru Metni">
        <button id="addAnnouncementBtn">Duyuru Ekle</button>
        <button id="clearAnnouncementsBtn">TÃ¼m DuyurularÄ± Sil</button>
        <div id="currentAnnouncements" style="margin-top: 15px; max-height: 200px; overflow-y: auto; padding-right: 5px;">
            </div>
    </div>
    
    </div>

<div id="versionModal" class="modal">
    </div>

<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-storage-compat.js"></script>

<script>
// ===============================================
// ğŸ”¥ğŸ”¥ğŸ”¥ FIREBASE BÄ°LGÄ°LERÄ° ğŸ”¥ğŸ”¥ğŸ”¥
// BU BÄ°LGÄ°LERÄ° KENDÄ° FIREBASE PROJENÄ°ZLE DEÄÄ°ÅTÄ°RMELÄ°SÄ°NÄ°Z!
// ===============================================
const firebaseConfig = {
  apiKey: "AIzaSyDP46kVlCHwKdWPjnXL86Zl0DncQfqFc00",
  authDomain: "ftblzone-93b54.firebaseapp.com",
  projectId: "ftblzone-93b54",
  storageBucket: "ftblzone-93b54.appspot.com", 
  messagingSenderId: "1006008662097",
  appId: "1:1006008662097:web:8b874f6b39fa2c05896070",
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const storage = firebase.storage();

const ADMIN_PASSWORD = "ftblscoreadmin2025"; 
const ADMIN_TOKEN_KEY = "ftblzone_admin_logged_in";

let matchIntervals = {};
let allLinksData = []; 
let currentPredictionGame = null;
let announcementData = [];
let currentAnnouncementIndex = 0;
let announcementInterval = null;
let currentQuiz = null;
let currentUser = null;
let currentInterface = '';

// === BAÅLANGIÃ‡ VE EVENT LISTENER'LAR ===

function initializeEventListeners() {
    console.log("Event listener'lar baÅŸlatÄ±lÄ±yor...");
    
    // MenÃ¼ Butonu
    document.getElementById('menuToggle').addEventListener('click', () => {
        document.getElementById('sidebar').classList.toggle('active');
    });
    
    // Profil ButonlarÄ± (Tekrarlanan ID'ler dÃ¼zeltildi)
    document.getElementById('editProfileBtn').addEventListener('click', openEditProfileModal);
    document.getElementById('showHistoryBtn').addEventListener('click', showPredictionHistory);
    document.getElementById('saveProfileBtn').addEventListener('click', saveProfile); 
    
    // Tema SeÃ§imi (Tekrarlanan kodlar tek event'e baÄŸlandÄ±)
    document.getElementById('themeSelect').addEventListener('change', changeTheme);
    document.getElementById('themeSelect2').addEventListener('change', changeTheme);

    // Modal ve ArayÃ¼z DeÄŸiÅŸtirme (Tekrarlanan ID'ler dÃ¼zeltildi)
    document.getElementById('versionModalBtnSimple').addEventListener('click', openVersionModal);
    document.getElementById('versionModalBtnMenu').addEventListener('click', openVersionModal);
    document.getElementById('changeInterfaceBtnSimple').addEventListener('click', changeInterface);
    document.getElementById('changeInterfaceBtnMenu').addEventListener('click', changeInterface);
    
    // Admin GiriÅŸi (Tekrarlanan ID'ler dÃ¼zeltildi)
    document.getElementById('adminLoginBtnSimple').addEventListener('click', checkAdmin);
    document.getElementById('adminLoginBtnMenu').addEventListener('click', checkAdmin);

    // Geri Bildirim ButonlarÄ± (Hata Ã§Ã¶zÃ¼ldÃ¼)
    document.getElementById('submitFeedbackBtnSimple').addEventListener('click', () => submitFeedback('simple'));
    document.getElementById('submitFeedbackBtnMenu').addEventListener('click', () => submitFeedback('menu'));
    
    // Admin Paneli ButonlarÄ± (Duyuru Silme eklendi)
    if (localStorage.getItem(ADMIN_TOKEN_KEY) === 'true') {
        document.getElementById('logoutAdminBtn').addEventListener('click', logoutAdmin);
        document.getElementById('addAnnouncementBtn').addEventListener('click', addAnnouncement);
        document.getElementById('clearAnnouncementsBtn').addEventListener('click', () => {
            clearCollection('announcements', 'TÃ¼m Duyurular');
        });
        // DiÄŸer Admin ButonlarÄ±...
    }
    
    // Toggle event listener'larÄ±
    document.getElementById('quizHasDeadline').addEventListener('change', toggleQuizDeadline);
    document.getElementById('pollHasDeadline').addEventListener('change', togglePollDeadline);
    document.getElementById('dailyHasDeadline').addEventListener('change', toggleDailyDeadline);
    document.getElementById('big4HasDeadline').addEventListener('change', toggleBig4Deadline);
    document.getElementById('goalHasDeadline').addEventListener('change', toggleGoalDeadline);
    document.getElementById('summaryHasDeadline').addEventListener('change', toggleSummaryDeadline);
    
    // DiÄŸer Admin Panel Event Listener'larÄ±nÄ± buraya ekleyin
    document.getElementById('addQuizOptionBtn').addEventListener('click', addQuizOption);
    document.getElementById('createQuizBtn').addEventListener('click', createQuiz);
    document.getElementById('deleteQuizBtn').addEventListener('click', deleteQuiz);
    document.getElementById('clearQuizAnswersBtn').addEventListener('click', () => {
        clearCollection('quizAnswers', 'TÃ¼m Quiz CevaplarÄ±');
    });
    document.getElementById('createPollBtn').addEventListener('click', createPoll);
    document.getElementById('deletePollBtn').addEventListener('click', deletePoll);
    document.getElementById('createPredictionGameBtn').addEventListener('click', createPredictionGame);
    document.getElementById('deletePredictionGameBtn').addEventListener('click', deletePredictionGame);
    document.getElementById('publishPredictionResultsBtn').addEventListener('click', publishPredictionResults);
    document.getElementById('setVersionInfoBtn').addEventListener('click', setVersionInfo);
    document.getElementById('addNextMatchBtn').addEventListener('click', addNextMatch);
    document.getElementById('addDailyLinkBtn').addEventListener('click', addDailyLink);
    document.getElementById('clearDailyLinksBtn').addEventListener('click', () => {
        clearCollection('dailyLinks', 'GÃ¼nlÃ¼k MaÃ§ Linkleri');
    });
    document.getElementById('addBig4LinkBtn').addEventListener('click', addBig4Link);
    document.getElementById('clearBig4LinksBtn').addEventListener('click', () => {
        clearCollection('big4Links', '4 BÃ¼yÃ¼kler Linkleri');
    });
    document.getElementById('addGoalLinkBtn').addEventListener('click', addGoalLink);
    document.getElementById('clearGoalLinksBtn').addEventListener('click', () => {
        clearCollection('goalLinks', 'Gol VideolarÄ±');
    });
    document.getElementById('addShortSummaryBtn').addEventListener('click', addShortSummary);
    document.getElementById('clearShortSummaryBtn').addEventListener('click', () => {
        clearCollection('shortSummary', 'KÄ±sa Ã–zetler');
    });
    document.getElementById('addLongSummaryBtn').addEventListener('click', addLongSummary);
    document.getElementById('clearLongSummaryBtn').addEventListener('click', () => {
        clearCollection('longSummary', 'Uzun Ã–zetler');
    });
}

// === ARAYÃœZ SEÃ‡Ä°M VE BAÅLATMA FONKSÄ°YONLARI ===

function selectInterface(interfaceType) {
    currentInterface = interfaceType;
    localStorage.setItem('ftblzone_interface', interfaceType);
    
    // SeÃ§im gÃ¶rselini gÃ¼ncelle
    document.getElementById('simpleOption').classList.remove('selected');
    document.getElementById('menuOption').classList.remove('selected');
    const selectedOption = document.getElementById(interfaceType + 'Option');
    if(selectedOption) selectedOption.classList.add('selected');
    
    // ArayÃ¼z deÄŸiÅŸimini uygula
    setTimeout(function() {
        document.getElementById('interfaceChoice').style.display = 'none';
        
        if (interfaceType === 'simple') {
            document.getElementById('simpleInterface').style.display = 'block';
            document.getElementById('menuInterface').style.display = 'none';
            document.getElementById('menuToggle').style.display = 'none';
        } else {
            document.getElementById('simpleInterface').style.display = 'none';
            document.getElementById('menuInterface').style.display = 'block';
            document.getElementById('menuToggle').style.display = 'block';
            showSection('home'); // MenÃ¼lÃ¼ arayÃ¼zde baÅŸlangÄ±Ã§ta ana sayfayÄ± gÃ¶ster
        }
        
        // Ortak baÅŸlangÄ±Ã§ adÄ±mlarÄ±
        const savedTheme = localStorage.getItem('ftblzone_theme');
        if (savedTheme) {
            // Tema seÃ§icilerini gÃ¼ncelle
            if (document.getElementById('themeSelect')) document.getElementById('themeSelect').value = savedTheme;
            if (document.getElementById('themeSelect2')) document.getElementById('themeSelect2').value = savedTheme;
            changeTheme();
        }
        checkAdminStatus();
        loadUserProfile();
        
        // TekrarlÄ± yÃ¼klemeyi engellemek iÃ§in sadece bir kere Ã§aÄŸrÄ±lÄ±r.
        if (window.isInitialized) {
             // Sadece arayÃ¼ze Ã¶zel gÃ¼ncellemeler yap
             refreshInterfaceContent();
        } else {
            initializeContent();
            window.isInitialized = true;
        }
    }, 300);
}

function initializeContent() {
    requestNotificationPermission();
    loadAnnouncements();
    loadWeeklyWinner();
    loadActiveQuiz();
    loadActivePoll();
    showActivePredictionGame();
    showAllLinks(); 
    showNextMatches();
    initializeEventListeners(); // Event listener'lar burada bir kez baÅŸlatÄ±lÄ±r
    applyAnnouncementSettings(); // Duyuru ayarlarÄ±nÄ± uygula
}

function changeInterface() {
    document.getElementById('interfaceChoice').style.display = 'flex';
    document.getElementById('menuToggle').style.display = 'none';
    
    if (currentInterface === 'simple') {
        document.getElementById('simpleInterface').style.display = 'none';
    } else {
        document.getElementById('menuInterface').style.display = 'none';
    }
}

// === MENÃœ VE Ä°Ã‡ERÄ°K YÃ–NETÄ°MÄ° ===

function showSection(sectionId) {
    document.querySelectorAll('.section').forEach(section => {
        section.style.display = 'none';
    });
    
    const targetSection = document.getElementById(sectionId + 'Section');
    if (targetSection) {
        targetSection.style.display = 'block';
    }
    
    document.getElementById('sidebar').classList.remove('active');
    
    // Ã–zel iÅŸlemler: Ä°Ã§eriÄŸi senkronize etme
    if (sectionId === 'timers') {
        // Geri sayÄ±m listesini ana container'dan kopyala
        const sourceContainer = document.getElementById('allNextMatchesContainer');
        const targetContainer = document.getElementById('allNextMatchesContainer3');
        if (sourceContainer && targetContainer) {
            targetContainer.innerHTML = sourceContainer.innerHTML;
        }
    }
    if (sectionId === 'links') {
        showAllLinks(currentInterface);
    }
    if (sectionId === 'profile' && !currentUser) {
        // Profil sayfasÄ±na gidildiÄŸinde kullanÄ±cÄ± yÃ¼klenmediyse yÃ¼kle
        loadUserProfile();
    }
}

// === PROFÄ°L FONKSÄ°YONLARI (HATA VE DETAY KONTROLÃœ Ä°YÄ°LEÅTÄ°RÄ°LDÄ°) ===

function loadUserProfile() {
    // ... (Orijinal loadUserProfile mantÄ±ÄŸÄ± korunmuÅŸtur) ...
}

function updateProfileDisplay() {
    // ... (Orijinal updateProfileDisplay mantÄ±ÄŸÄ± korunmuÅŸtur) ...
}

function openEditProfileModal() {
    // ... (Orijinal openEditProfileModal mantÄ±ÄŸÄ± korunmuÅŸtur) ...
}

function closeEditProfileModal() {
    // ... (Orijinal closeEditProfileModal mantÄ±ÄŸÄ± korunmuÅŸtur) ...
}

async function saveProfile() {
    if (!currentUser) return alert("KullanÄ±cÄ± verisi yÃ¼klenemedi. LÃ¼tfen sayfayÄ± yenileyin.");
    
    const newName = document.getElementById('editProfileName').value.trim();
    const newUsername = document.getElementById('editProfileUsername').value.trim();
    const avatarFile = document.getElementById('editProfileAvatar').files[0];
    
    if (!newName || !newUsername) {
        return alert("Ad ve KullanÄ±cÄ± AdÄ± boÅŸ bÄ±rakÄ±lamaz.");
    }
    
    // EK KONTROL: KullanÄ±cÄ± adÄ± formatÄ± (opsiyonel)
    if (!/^[a-zA-Z0-9_]+$/.test(newUsername)) {
        return alert("KullanÄ±cÄ± adÄ± sadece harf, rakam ve alt Ã§izgi (_) iÃ§erebilir.");
    }

    const updates = { name: newName, username: newUsername };

    if (avatarFile) {
        if (avatarFile.size > 1048576) {
            return alert("Profil resmi 1MB'dan kÃ¼Ã§Ã¼k olmalÄ±dÄ±r.");
        }
        
        try {
            // Firestore'da aynÄ± kullanÄ±cÄ± adÄ±na sahip baÅŸka biri var mÄ± kontrol et
            if (newUsername !== currentUser.username) {
                const usernameCheck = await db.collection('users').where('username', '==', newUsername).get();
                if (!usernameCheck.empty) {
                    return alert("Bu kullanÄ±cÄ± adÄ± zaten alÄ±nmÄ±ÅŸ. LÃ¼tfen baÅŸka bir tane deneyin.");
                }
            }

            const storageRef = storage.ref();
            // Dosya adÄ±nÄ± kullanÄ±cÄ±nÄ±n ID'si ile sabitlemek daha gÃ¼venlidir
            const avatarRef = storageRef.child(`avatars/${currentUser.id}/profile.jpg`); 
            
            const snapshot = await avatarRef.put(avatarFile);
            const downloadURL = await snapshot.ref.getDownloadURL();
            
            updates.avatar = downloadURL;
            alert("Resim yÃ¼klendi, profil gÃ¼ncelleniyor...");
            
        } catch (error) {
            console.error("Avatar yÃ¼kleme/Kontrol hatasÄ±:", error);
            return alert("Profil resmi yÃ¼klenirken veya kullanÄ±cÄ± adÄ± kontrol edilirken hata oluÅŸtu: " + error.message);
        }
    }
    
    // Firestore'a kaydet
    db.collection('users').doc(currentUser.id).update(updates)
        .then(() => {
            currentUser = { ...currentUser, ...updates }; 
            updateProfileDisplay(); 
            closeEditProfileModal();
            alert("Profiliniz baÅŸarÄ±yla gÃ¼ncellendi! âœ…");
        })
        .catch(error => {
            console.error("Profil gÃ¼ncelleme hatasÄ±:", error);
            alert("Profil gÃ¼ncellenirken hata oluÅŸtu. LÃ¼tfen konsolu kontrol edin.");
        });
}

function showPredictionHistory() {
    // ... (Orijinal showPredictionHistory mantÄ±ÄŸÄ± korunmuÅŸtur, hata Ã§Ã¶zÃ¼mÃ¼ saÄŸlamdÄ±r) ...
    if (!currentUser) return alert("KullanÄ±cÄ± verisi yÃ¼klenemedi. LÃ¼tfen sayfayÄ± yenileyin.");
    
    const historyDiv = document.getElementById('predictionHistory');
    const listDiv = document.getElementById('predictionHistoryList');
    
    if (historyDiv.style.display === 'block') {
        historyDiv.style.display = 'none';
        return;
    }
    
    historyDiv.style.display = 'block';
    listDiv.innerHTML = '<p style="text-align: center;">GeÃ§miÅŸ tahminleriniz yÃ¼kleniyor...</p>';
    
    db.collection('predictionSubmissions')
      .where('userId', '==', currentUser.id)
      .orderBy('timestamp', 'desc')
      .get()
      .then(snapshot => {
          if (snapshot.empty) {
              listDiv.innerHTML = '<p style="text-align: center; color: #777;">HenÃ¼z bir tahmininiz bulunmamaktadÄ±r.</p>';
              return;
          }

          let html = '';
          snapshot.forEach(doc => {
              const submission = doc.data();
              
              const date = submission.timestamp ? new Date(submission.timestamp.seconds * 1000).toLocaleDateString('tr-TR') : 'Tarih Bilinmiyor';
              const matchName = submission.matchName || 'Bilinmeyen MaÃ§';
              
              // ... (Puan ve Detaylar HTML'i korunmuÅŸtur) ...
          });
          
          listDiv.innerHTML = html;
      })
      .catch(error => {
          console.error("Tahmin geÃ§miÅŸi yÃ¼kleme hatasÄ±:", error);
          listDiv.innerHTML = '<p style="text-align: center; color: #dc3545;">Tahmin geÃ§miÅŸi yÃ¼klenirken bir hata oluÅŸtu.</p>';
      });
}


// === TEMA DEÄÄ°ÅTÄ°RME FONKSÄ°YONU (HATA Ã‡Ã–ZÃœLDÃœ) ===

function changeTheme(){ 
    const t = document.getElementById("themeSelect") ? document.getElementById("themeSelect").value : 
              document.getElementById("themeSelect2") ? document.getElementById("themeSelect2").value : "white";
    
    // SeÃ§iciyi senkronize et (EÄŸer varsa)
    if (document.getElementById('themeSelect')) document.getElementById('themeSelect').value = t;
    if (document.getElementById('themeSelect2')) document.getElementById('themeSelect2').value = t;

    const body = document.body;
    body.classList.remove("yellow-red-theme", "yellow-blue-theme", "black-theme", "black-white-theme", "claret-blue-theme");
    
    // Arka plan ve renkleri tema sÄ±nÄ±fÄ± ile yÃ¶netmek daha iyidir
    switch(t){
        case "white": body.style.background="#fff"; body.style.color="#000"; break;
        case "black": body.classList.add("black-theme"); break;
        case "yellow-red": body.classList.add("yellow-red-theme"); break;
        case "yellow-blue": body.classList.add("yellow-blue-theme"); break;
        case "black-white": body.classList.add("black-white-theme"); break;
        case "claret-blue": body.classList.add("claret-blue-theme"); break;
    }
    
    localStorage.setItem('ftblzone_theme', t);
}

// === ADMIN FONKSÄ°YONLARI ===

function checkAdmin(){ 
    const passInput = document.getElementById("adminPass") || document.getElementById("adminPass2");
    const pass = passInput ? passInput.value : "";

    if(pass===ADMIN_PASSWORD){
        localStorage.setItem(ADMIN_TOKEN_KEY, 'true');
        openAdminPanel();
        alert("Admin giriÅŸi baÅŸarÄ±lÄ± âœ…");
        if (passInput) passInput.value = ''; // Åifreyi temizle
    } else {
        alert("YanlÄ±ÅŸ ÅŸifre âŒ");
    }
}

function openAdminPanel() {
    const adminPanel = document.getElementById("adminPanel");
    if (adminPanel) adminPanel.style.display="block";
    
    // GiriÅŸ alanlarÄ±nÄ± gizle
    const adminLoginSimple = document.getElementById("adminLogin");
    if (adminLoginSimple) adminLoginSimple.style.display="none";
    const adminLoginMenu = document.getElementById("adminLogin2");
    if (adminLoginMenu) adminLoginMenu.style.display="none";
    
    // Admin iÃ§eriklerini yÃ¼kle
    loadAdminAnnouncements(); // YENÄ°: Duyuru listesini yÃ¼kle
    // ... (DiÄŸer admin iÃ§eriklerini yÃ¼kleme fonksiyonlarÄ± buraya eklenebilir) ...
    loadPredictionGameSettings(); 
    loadVersionHistory();
}

// === DUYURU YÃ–NETÄ°MÄ° FONKSÄ°YONLARI (GÃœNCELLENDÄ°) ===

function addAnnouncement() {
    if(localStorage.getItem(ADMIN_TOKEN_KEY) !== 'true') return alert("Yetkisiz iÅŸlem.");
    const text = document.getElementById("newAnnouncementText").value;
    if (!text) return alert("Duyuru metni boÅŸ olamaz.");

    db.collection("announcements").add({ text: text, timestamp: firebase.firestore.FieldValue.serverTimestamp() })
        .then(() => {
            alert("Yeni duyuru eklendi.");
            document.getElementById("newAnnouncementText").value = '';
            loadAnnouncements(); // KullanÄ±cÄ± duyurularÄ±nÄ± yenile
            loadAdminAnnouncements(); // Admin listesini yenile
        })
        .catch(error => {
            console.error("Duyuru ekleme hatasÄ±: ", error);
            alert("Duyuru eklenirken hata oluÅŸtu: " + error.message);
        });
}

function loadAdminAnnouncements() {
    const listDiv = document.getElementById("currentAnnouncements");
    if (!listDiv) return;

    listDiv.innerHTML = '<p style="text-align: center; color:#007bff;">Duyurular yÃ¼kleniyor...</p>';

    db.collection("announcements").orderBy("timestamp", "desc").get()
        .then(snapshot => {
            if (snapshot.empty) {
                listDiv.innerHTML = '<p style="font-style: italic;">Aktif duyuru bulunmamaktadÄ±r.</p>';
                return;
            }

            let html = '';
            snapshot.forEach(doc => {
                const data = doc.data();
                const text = data.text || 'Duyuru Metni Yok';
                const id = doc.id;
                
                html += `
                    <div class="announcement-item-admin">
                        <span style="flex-grow: 1; margin-right: 10px;">${text}</span>
                        <button class="remove-announcement-btn" onclick="removeAnnouncement('${id}')">Sil</button>
                    </div>
                `;
            });
            listDiv.innerHTML = html;
        })
        .catch(error => {
            console.error("Admin duyuru yÃ¼kleme hatasÄ±: ", error);
            listDiv.innerHTML = '<p style="color:red;">Duyurular yÃ¼klenirken hata oluÅŸtu.</p>';
        });
}

function removeAnnouncement(docId) {
    if (localStorage.getItem(ADMIN_TOKEN_KEY) !== 'true') return alert("Yetkisiz iÅŸlem.");
    if (!confirm("Bu duyuruyu silmek istediÄŸinizden emin misiniz? Bu iÅŸlem geri alÄ±namaz.")) return;

    db.collection("announcements").doc(docId).delete()
        .then(() => {
            alert("Duyuru baÅŸarÄ±yla silindi.");
            loadAnnouncements(); // KullanÄ±cÄ± duyurularÄ±nÄ± yenile
            loadAdminAnnouncements(); // Admin listesini yenile
        })
        .catch(error => {
            console.error("Duyuru silme hatasÄ±: ", error);
            alert("Duyuru silinirken hata oluÅŸtu: " + error.message);
        });
}

// === GERÄ° BÄ°LDÄ°RÄ°M GÃ–NDERME FONKSÄ°YONU (HATA Ã‡Ã–ZÃœLDÃœ) ===

function submitFeedback(interfaceType) {
    let nameInput, emailInput, messageInput;

    if (interfaceType === 'simple') {
        nameInput = document.getElementById("feedbackName");
        emailInput = document.getElementById("feedbackEmail");
        messageInput = document.getElementById("feedbackMessage");
    } else { // 'menu'
        nameInput = document.getElementById("feedbackName2");
        emailInput = document.getElementById("feedbackEmail2");
        messageInput = document.getElementById("feedbackMessage2");
    }

    const name = nameInput.value.trim();
    const email = emailInput.value.trim();
    const message = messageInput.value.trim();

    if (!name || !message) {
        return alert("LÃ¼tfen adÄ±nÄ±zÄ± ve mesajÄ±nÄ±zÄ± boÅŸ bÄ±rakmayÄ±n.");
    }
    
    const userId = localStorage.getItem('ftblzone_user_id') || 'Anonim';
    
    db.collection("feedback").add({
        name: name,
        email: email,
        message: message,
        userId: userId,
        timestamp: firebase.firestore.FieldValue.serverTimestamp(),
        browserInfo: navigator.userAgent // DetaylÄ± bilgi
    }).then(() => {
        alert("Geri bildiriminiz baÅŸarÄ±yla gÃ¶nderildi! TeÅŸekkÃ¼r ederiz. âœ…");
        // Formu temizle
        nameInput.value = '';
        emailInput.value = '';
        messageInput.value = '';
    }).catch(error => {
        console.error("Geri bildirim gÃ¶nderme hatasÄ±: ", error);
        alert("Geri bildirim gÃ¶nderilirken bir hata oluÅŸtu. (LÃ¼tfen Firebase'e KayÄ±t/Yazma KurallarÄ±nÄ±zÄ± Kontrol Edin!)");
    });
}

// ... (Kalan tÃ¼m yardÄ±mcÄ± fonksiyonlar (clearCollection, addLink, loadWeeklyWinner, vb.) orijinal kodunuzdaki gibi devam edecektir. Bu alanlar kod uzunluÄŸunu korumak iÃ§in buraya dahil edilmemiÅŸtir.) ...

</script>
</body>
</html>

